Build Debian package for Logstash plugins used in Wikimedia deployments.

# Requisites

You will need a WMCS Cloud VPS host with docker and Debian packaging toolchain installed:

  apt install -y docker.io build-essential devscripts debhelper

And this repository cloned in the same host:

  git clone https://gerrit.wikimedia.org/r/operations/software/logstash/plugins logstash-plugins
  cd logstash-plugins

# Build

Increment the Debian version before building the package and commit the result:

  dch -m --release
  git commit -m "New package version" debian/changelog

Then build the package:

  debuild -us -uc -b

If all goes well the resulting package will be in

../logstash-plugins_$(dpkg-parsechangelog --show-field Version)_all.deb

Once happy with the result, commit/push the changes:

  git commit -m "debian: new version" debian/changelog
  git push

Multiple Logstash versions are supported within the same Debian package.

# Deploy

Copy the package to the "apt host" (e.g. apt1001.wikimedia.org) then include it in the desired
distribution, for example (as root):

  reprepro includedeb buster-wikimedia <path>

The package is now available to production, and can be upgraded as needed. The plugins will be
installed automatically on package installation.

# References

Debian packaging/uploading guide https://wikitech.wikimedia.org/wiki/Debian_Packaging
